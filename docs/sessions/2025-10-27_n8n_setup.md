# Session Notes: n8n Workflow Setup

**Date:** 2025-10-27  
**Duration:** ~3 hours  
**Status:** 🔄 IN PROGRESS - n8n Setup Complete, Ready for Testing  
**Focus:** Migrate from Python orchestrator to n8n workflow

---

## ✅ Čo Je HOTOVÉ

### **1. Context API Service**
- ✅ Vytvorený `services/context_api.py` s endpoints:
  - `GET /health`
  - `POST /parse-task` (NOVÝ - parsuje task.md)
  - `POST /build-context` (smart context building)
  - `GET /list-projects`
  - `GET /project-info/<name>`
- ✅ Dependencies nainštalované (`flask`, `flask-cors`)
- ✅ venv vytvorený a aktivovaný v `claude-dev-automation/`
- ✅ Flask server beží na `http://localhost:5000`

### **2. n8n Workflow**
- ✅ Workflow JSON vytvorený: `workflows/n8n-claude-dev-automation.json`
- ✅ Workflow README vytvorený: `workflows/README.md`
- ✅ Workflow importovaný do n8n pod názvom "n8n-claude-dev-automation"
- ✅ Anthropic API key credential nastavený v n8n:
  - Type: HTTP Header Auth
  - Header Name: `x-api-key`
  - Name: `antropic-claude-apy-key`

### **3. Git**
- ✅ `workflows/` adresár commitnutý a pushnutý
- ✅ Session notes pushnuté

---

## ⏳ Čo ZOSTÁVA (Pre Nový Chat)

### **Immediate Next Steps:**

1. **Opraviť "Parse Task" node v n8n**
   - Problém: n8n Code node nemá prístup k `fs` module
   - Riešenie: Zmeniť na HTTP Request node
   - **Action:**
     - Vymazať súčasný Code node "Parse Task" (červený)
     - Pridať HTTP Request node
     - Nastaviť:
       - Method: POST
       - URL: `http://localhost:5000/parse-task`
       - Body: JSON `{}`
     - Prepojiť: Manual Trigger → Parse Task → Build Smart Context

2. **Over všetky ostatné nodes**
   - Build Smart Context (HTTP Request)
   - Call Claude API (HTTP Request s credentials)
   - Parse File Operations (Code node)
   - Execute File Operations (Code node)
   - Git Commit (Execute Command)
   - Generate Clean Response (Code node)
   - Save Response (Code node)

3. **Test workflow**
   - Execute Workflow v n8n
   - Sledovať nodes (zelené = OK, červené = error)
   - Overiť response.md (má byť 1-2k, nie 25-30k!)

4. **Overiť výsledky**
   - `workspace/response.md` - clean summary
   - `uae-legal-agent/hello.txt` - vytvorený súbor
   - Git commit v uae-legal-agent

---

## 🏗️ Architektúra

### **Current Setup:**

```
n8n Workflow (9 nodes)
    ↓
Parse Task → HTTP POST localhost:5000/parse-task
    ↓
Build Smart Context → HTTP POST localhost:5000/build-context
    ↓
Call Claude API → HTTP POST api.anthropic.com
    ↓
Parse File Operations → Code node (JavaScript)
    ↓
Execute File Operations → Code node (JavaScript)
    ↓
Git Commit → Execute Command node
    ↓
Generate Clean Response → Code node (JavaScript)
    ↓
Save Response → Code node (JavaScript)
```

### **Flask Context API:**
- Port: 5000
- venv: `claude-dev-automation/venv/`
- Dependencies: flask, flask-cors, anthropic, python-dotenv

---

## 📂 File Structure

```
claude-dev-automation/
├── tools/                          # Python modules (existing)
│   ├── enhanced_context_builder.py ✅
│   └── ... (other modules)
├── workspace/                      # task.md, response.md
│   ├── task.md                    ✅ Test task ready
│   ├── response.md                (will be generated)
│   └── .env                       ✅ API key
├── services/                      ✅ NEW
│   ├── context_api.py             ✅ Flask API
│   └── requirements.txt           ✅ Dependencies
├── workflows/                     ✅ NEW
│   ├── n8n-claude-dev-automation.json ✅
│   └── README.md                  ✅
├── docs/
│   └── sessions/
│       └── 2025-10-27_n8n_migration.md ✅
└── venv/                          ✅ NEW - virtual environment
```

---

## 🐛 Known Issues

### **Issue 1: Parse Task Node Error**
**Error:** `Cannot find module 'fs' [Line 2]`  
**Cause:** n8n Code node má obmedzený prístup k Node.js modulom  
**Status:** ⏳ NEEDS FIX  
**Solution:** Change to HTTP Request node calling `/parse-task` endpoint

### **Issue 2: Other Nodes Not Tested Yet**
**Status:** ⏳ NEEDS TESTING  
All other nodes after Parse Task need to be tested once Parse Task is fixed.

---

## 💡 Key Decisions Made

### **Decision 1: n8n Over Python Orchestrator**
**Reason:**
- Vizuálny workflow
- Jednoduchší debugging
- Lepšia škálovateľnosť
- Response.md bude 1-2k (nie 25-30k)

### **Decision 2: Hybrid Architecture (n8n + Python API)**
**Reason:**
- n8n Code nodes majú obmedzenia
- Python API umožňuje reuse existujúcich modulov
- Separation of concerns

### **Decision 3: venv Pre Projekt**
**Reason:**
- Izolácia dependencies
- Production best practice
- Ľahšie deployment

---

## 📊 Current State

| Component | Status | Port/Location |
|-----------|--------|---------------|
| **Flask Context API** | ✅ Running | http://localhost:5000 |
| **n8n Server** | ✅ Running | http://localhost:5678 |
| **n8n Workflow** | 🔄 Imported, needs fixing | "n8n-claude-dev-automation" |
| **Parse Task Node** | ❌ Error (fs module) | Needs HTTP Request replacement |
| **API Credentials** | ✅ Set | "antropic-claude-apy-key" |
| **Test Task** | ✅ Ready | workspace/task.md |
| **venv** | ✅ Active | claude-dev-automation/venv/ |

---

## 🎯 For New Chat - Start Here

### **Context for Claude:**

"Pokračujeme v setup n8n workflow pre claude-dev-automation projekt. 

**Čo je hotové:**
- Flask Context API beží na localhost:5000 ✅
- n8n workflow importovaný ✅
- API credentials nastavené ✅
- venv vytvorený a aktivovaný ✅

**Problém ktorý riešime:**
- Node "Parse Task" v n8n má error: Cannot find module 'fs'
- Potrebujeme ho zmeniť na HTTP Request node ktorý volá localhost:5000/parse-task

**Ďalšie kroky:**
1. Opraviť Parse Task node (zmeniť na HTTP Request)
2. Otestovať celý workflow
3. Overiť že response.md je malý (1-2k)
4. Overiť že súbory sa vytvárajú v projekte"

### **Important Files:**
- Workflow JSON: `workflows/n8n-claude-dev-automation.json`
- Flask API: `services/context_api.py` (beží)
- Task file: `workspace/task.md` (ready for testing)
- Session notes: `docs/sessions/2025-10-27_n8n_migration.md`

### **Quick Commands:**
```bash
# Flask API (should be running)
cd C:\Development\claude-dev-automation
venv\Scripts\activate
cd services
python context_api.py

# Test endpoints
curl http://localhost:5000/health
curl -X POST http://localhost:5000/parse-task
```

---

## 📞 Quick Reference

**n8n URL:** http://localhost:5678  
**Workflow Name:** n8n-claude-dev-automation  
**Flask API:** http://localhost:5000  
**Project Path:** C:/Development/claude-dev-automation  
**venv:** Active in project root

---

**Next Session:** Fix Parse Task node, test complete workflow

---

_"From Python chaos to n8n clarity - almost there!"_