# Session Notes: n8n Workflow Setup

**Date:** 2025-10-27  
**Duration:** ~3 hours  
**Status:** ğŸ”„ IN PROGRESS - n8n Setup Complete, Ready for Testing  
**Focus:** Migrate from Python orchestrator to n8n workflow

---

## âœ… ÄŒo Je HOTOVÃ‰

### **1. Context API Service**
- âœ… VytvorenÃ½ `services/context_api.py` s endpoints:
  - `GET /health`
  - `POST /parse-task` (NOVÃ - parsuje task.md)
  - `POST /build-context` (smart context building)
  - `GET /list-projects`
  - `GET /project-info/<name>`
- âœ… Dependencies nainÅ¡talovanÃ© (`flask`, `flask-cors`)
- âœ… venv vytvorenÃ½ a aktivovanÃ½ v `claude-dev-automation/`
- âœ… Flask server beÅ¾Ã­ na `http://localhost:5000`

### **2. n8n Workflow**
- âœ… Workflow JSON vytvorenÃ½: `workflows/n8n-claude-dev-automation.json`
- âœ… Workflow README vytvorenÃ½: `workflows/README.md`
- âœ… Workflow importovanÃ½ do n8n pod nÃ¡zvom "n8n-claude-dev-automation"
- âœ… Anthropic API key credential nastavenÃ½ v n8n:
  - Type: HTTP Header Auth
  - Header Name: `x-api-key`
  - Name: `antropic-claude-apy-key`

### **3. Git**
- âœ… `workflows/` adresÃ¡r commitnutÃ½ a pushnutÃ½
- âœ… Session notes pushnutÃ©

---

## â³ ÄŒo ZOSTÃVA (Pre NovÃ½ Chat)

### **Immediate Next Steps:**

1. **OpraviÅ¥ "Parse Task" node v n8n**
   - ProblÃ©m: n8n Code node nemÃ¡ prÃ­stup k `fs` module
   - RieÅ¡enie: ZmeniÅ¥ na HTTP Request node
   - **Action:**
     - VymazaÅ¥ sÃºÄasnÃ½ Code node "Parse Task" (ÄervenÃ½)
     - PridaÅ¥ HTTP Request node
     - NastaviÅ¥:
       - Method: POST
       - URL: `http://localhost:5000/parse-task`
       - Body: JSON `{}`
     - PrepojiÅ¥: Manual Trigger â†’ Parse Task â†’ Build Smart Context

2. **Over vÅ¡etky ostatnÃ© nodes**
   - Build Smart Context (HTTP Request)
   - Call Claude API (HTTP Request s credentials)
   - Parse File Operations (Code node)
   - Execute File Operations (Code node)
   - Git Commit (Execute Command)
   - Generate Clean Response (Code node)
   - Save Response (Code node)

3. **Test workflow**
   - Execute Workflow v n8n
   - SledovaÅ¥ nodes (zelenÃ© = OK, ÄervenÃ© = error)
   - OveriÅ¥ response.md (mÃ¡ byÅ¥ 1-2k, nie 25-30k!)

4. **OveriÅ¥ vÃ½sledky**
   - `workspace/response.md` - clean summary
   - `uae-legal-agent/hello.txt` - vytvorenÃ½ sÃºbor
   - Git commit v uae-legal-agent

---

## ğŸ—ï¸ ArchitektÃºra

### **Current Setup:**

```
n8n Workflow (9 nodes)
    â†“
Parse Task â†’ HTTP POST localhost:5000/parse-task
    â†“
Build Smart Context â†’ HTTP POST localhost:5000/build-context
    â†“
Call Claude API â†’ HTTP POST api.anthropic.com
    â†“
Parse File Operations â†’ Code node (JavaScript)
    â†“
Execute File Operations â†’ Code node (JavaScript)
    â†“
Git Commit â†’ Execute Command node
    â†“
Generate Clean Response â†’ Code node (JavaScript)
    â†“
Save Response â†’ Code node (JavaScript)
```

### **Flask Context API:**
- Port: 5000
- venv: `claude-dev-automation/venv/`
- Dependencies: flask, flask-cors, anthropic, python-dotenv

---

## ğŸ“‚ File Structure

```
claude-dev-automation/
â”œâ”€â”€ tools/                          # Python modules (existing)
â”‚   â”œâ”€â”€ enhanced_context_builder.py âœ…
â”‚   â””â”€â”€ ... (other modules)
â”œâ”€â”€ workspace/                      # task.md, response.md
â”‚   â”œâ”€â”€ task.md                    âœ… Test task ready
â”‚   â”œâ”€â”€ response.md                (will be generated)
â”‚   â””â”€â”€ .env                       âœ… API key
â”œâ”€â”€ services/                      âœ… NEW
â”‚   â”œâ”€â”€ context_api.py             âœ… Flask API
â”‚   â””â”€â”€ requirements.txt           âœ… Dependencies
â”œâ”€â”€ workflows/                     âœ… NEW
â”‚   â”œâ”€â”€ n8n-claude-dev-automation.json âœ…
â”‚   â””â”€â”€ README.md                  âœ…
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ sessions/
â”‚       â””â”€â”€ 2025-10-27_n8n_migration.md âœ…
â””â”€â”€ venv/                          âœ… NEW - virtual environment
```

---

## ğŸ› Known Issues

### **Issue 1: Parse Task Node Error**
**Error:** `Cannot find module 'fs' [Line 2]`  
**Cause:** n8n Code node mÃ¡ obmedzenÃ½ prÃ­stup k Node.js modulom  
**Status:** â³ NEEDS FIX  
**Solution:** Change to HTTP Request node calling `/parse-task` endpoint

### **Issue 2: Other Nodes Not Tested Yet**
**Status:** â³ NEEDS TESTING  
All other nodes after Parse Task need to be tested once Parse Task is fixed.

---

## ğŸ’¡ Key Decisions Made

### **Decision 1: n8n Over Python Orchestrator**
**Reason:**
- VizuÃ¡lny workflow
- JednoduchÅ¡Ã­ debugging
- LepÅ¡ia Å¡kÃ¡lovateÄ¾nosÅ¥
- Response.md bude 1-2k (nie 25-30k)

### **Decision 2: Hybrid Architecture (n8n + Python API)**
**Reason:**
- n8n Code nodes majÃº obmedzenia
- Python API umoÅ¾Åˆuje reuse existujÃºcich modulov
- Separation of concerns

### **Decision 3: venv Pre Projekt**
**Reason:**
- IzolÃ¡cia dependencies
- Production best practice
- Ä½ahÅ¡ie deployment

---

## ğŸ“Š Current State

| Component | Status | Port/Location |
|-----------|--------|---------------|
| **Flask Context API** | âœ… Running | http://localhost:5000 |
| **n8n Server** | âœ… Running | http://localhost:5678 |
| **n8n Workflow** | ğŸ”„ Imported, needs fixing | "n8n-claude-dev-automation" |
| **Parse Task Node** | âŒ Error (fs module) | Needs HTTP Request replacement |
| **API Credentials** | âœ… Set | "antropic-claude-apy-key" |
| **Test Task** | âœ… Ready | workspace/task.md |
| **venv** | âœ… Active | claude-dev-automation/venv/ |

---

## ğŸ¯ For New Chat - Start Here

### **Context for Claude:**

"PokraÄujeme v setup n8n workflow pre claude-dev-automation projekt. 

**ÄŒo je hotovÃ©:**
- Flask Context API beÅ¾Ã­ na localhost:5000 âœ…
- n8n workflow importovanÃ½ âœ…
- API credentials nastavenÃ© âœ…
- venv vytvorenÃ½ a aktivovanÃ½ âœ…

**ProblÃ©m ktorÃ½ rieÅ¡ime:**
- Node "Parse Task" v n8n mÃ¡ error: Cannot find module 'fs'
- Potrebujeme ho zmeniÅ¥ na HTTP Request node ktorÃ½ volÃ¡ localhost:5000/parse-task

**ÄalÅ¡ie kroky:**
1. OpraviÅ¥ Parse Task node (zmeniÅ¥ na HTTP Request)
2. OtestovaÅ¥ celÃ½ workflow
3. OveriÅ¥ Å¾e response.md je malÃ½ (1-2k)
4. OveriÅ¥ Å¾e sÃºbory sa vytvÃ¡rajÃº v projekte"

### **Important Files:**
- Workflow JSON: `workflows/n8n-claude-dev-automation.json`
- Flask API: `services/context_api.py` (beÅ¾Ã­)
- Task file: `workspace/task.md` (ready for testing)
- Session notes: `docs/sessions/2025-10-27_n8n_migration.md`

### **Quick Commands:**
```bash
# Flask API (should be running)
cd C:\Development\claude-dev-automation
venv\Scripts\activate
cd services
python context_api.py

# Test endpoints
curl http://localhost:5000/health
curl -X POST http://localhost:5000/parse-task
```

---

## ğŸ“ Quick Reference

**n8n URL:** http://localhost:5678  
**Workflow Name:** n8n-claude-dev-automation  
**Flask API:** http://localhost:5000  
**Project Path:** C:/Development/claude-dev-automation  
**venv:** Active in project root

---

**Next Session:** Fix Parse Task node, test complete workflow

---

_"From Python chaos to n8n clarity - almost there!"_